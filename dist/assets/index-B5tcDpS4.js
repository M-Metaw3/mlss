import{c as N}from"./checkPermission-Ceto9Xa7.js";import{v as A,u as C,r as _,y as L,f as q,h as V,w as d,P as X,x as j,g as y,o as l,a as p,j as h,i as w,c,t as r,b as P,F as U,N as D}from"./index-PF4Eq7D6.js";import"./hasPermission-CVzDC8fh.js";const R={class:"mb-5 grid grid-cols-12 gap-3 lg:mb-7 lg:gap-5"},M={class:"col-span-12 xl:col-span-4"},J={class:"col-span-12 xl:col-span-4"},O={key:0,class:"flex items-center justify-center rounded-[10px] bg-white py-10 dark:bg-transparent"},z={key:0,class:"flex items-center justify-end"},G={type:"button",class:"mb-5 rounded-full bg-primary px-7 py-3 text-white"},H=["href"],K=["href"],Q={key:1},W={key:0,class:"capitalize"},Y={key:1},Z={key:0},ee={key:1},ae={key:2},le={__name:"index",setup(oe){const u=X(),x=j();A();const o=C();function E(a,n){x.push({path:"/companies",query:Object.assign({},u.query,{[a]:n})})}const b=_(u.query.name||"");L(b,a=>{E("name",a)});const g=_([{id:"brokerage_company",name:o.t("INPUTS.brokerageCompany")},{id:"developer_company",name:o.t("INPUTS.developerCompany")}]),S=_(u.query.company_type||"");L(S,a=>{var t;const n=(t=g.value.find(i=>i.name===a))==null?void 0:t.id;E("company_type",n)});const f=_({columns:[{label:o.t("LABELS.name"),field:"name"},{label:"MLS ID",field:"tax_id"},{label:o.t("LABELS.companyType"),field:"company_type"},{label:o.t("TITLES.address"),field:"address"},{label:o.t("LABELS.phoneNumber"),field:"phone"},{label:o.t("TITLES.email"),field:"email"},{label:"",field:"show"},{label:"",field:"control"}],rows:[]}),k=_([]),v=_(!1);async function F(){v.value=!0,await D.get("/admin/companies",{params:{name:u.query.name||"",company_name:u.query.company_type||""}}).then(a=>{const n=a.data.data.map((t,i)=>{var s,m;return{...t.company,company_type:(m=(s=a.data.data[i])==null?void 0:s.company_type)==null?void 0:m.replaceAll("_"," ")}});f.value.rows=n,f.value.rows.forEach((t,i)=>{var m,T;const s={};s[o.t("LABELS.name")]=t.name,s["MLS ID"]=t.tax_id,s[o.t("LABELS.phoneNumber")]=t.phone,s[o.t("TITLES.email")]=t.email,t.address?s[o.t("TITLES.address")]=t.address||o.t("TEXTS.notFound"):t.branches.length?s[o.t("TITLES.address")]=t.branches[0].address:s[o.t("TITLES.address")]=o.t("TEXTS.notFound"),s[o.t("LABELS.companyType")]=(T=(m=a.data.data[i])==null?void 0:m.company_type)==null?void 0:T.replaceAll("_"," "),k.value.push(s)})}).catch(a=>console.error(a)).finally(()=>v.value=!1)}function B(a){const n=a.find(t=>t.is_master===1);return n?n.address:o.t("TEXTS.notFound")}return L(()=>u.query,()=>{F()},{deep:!0,immediate:!0}),q(()=>{N("Get Companies")}),(a,n)=>{const t=y("Search"),i=y("Select"),s=y("Loader"),m=y("JsonExcel"),T=y("RouterLink"),I=y("Table"),$=y("Card");return l(),V($,{class:"card-shadow my-5"},{default:d(()=>[p("div",R,[p("div",M,[h(t,{modelValue:b.value,"onUpdate:modelValue":n[0]||(n[0]=e=>b.value=e),disabled:v.value,placeholder:a.$t("INPUTS.companiesSearch")},null,8,["modelValue","disabled","placeholder"])]),p("div",J,[h(i,{id:"companyTypeFilter",label:a.$t("LABELS.companyType"),placeholder:a.$t("INPUTS.select"),defaultValue:w(u).query.company_type||"",disabled:v.value,options:g.value,clearable:!0,onSelect:n[1]||(n[1]=e=>S.value=e),onClear:n[2]||(n[2]=e=>S.value="")},null,8,["label","placeholder","defaultValue","disabled","options"])])]),v.value?(l(),c("div",O,[h(s)])):(l(),c(U,{key:1},[f.value.rows.length?(l(),c("div",z,[h(m,{data:k.value,rtl:w(o).locale.value==="ar",name:"Companies"},{default:d(()=>[p("button",G,r(a.$t("BUTTONS.exportData")),1)]),_:1},8,["data","rtl"])])):P("",!0),h(I,{"is-slot-mode":!0,columns:f.value.columns,rows:f.value.rows,pagination:!1,"is-hide-paging":!0,class:"font-medium"},{name:d(e=>[p("span",null,r(e.value.name||a.$t("TEXTS.notFound")),1)]),tax_id:d(e=>[p("span",null,r(e.value.tax_id||a.$t("TEXTS.notFound")),1)]),email:d(e=>[p("a",{href:`mailto:${e.value.email}`},r(e.value.email),9,H)]),phone:d(e=>[e.value.phone?(l(),c("a",{key:0,href:`tel:${e.value.phone}`},r(e.value.phone),9,K)):(l(),c("span",Q,r(a.$t("TEXTS.notFound")),1))]),company_type:d(e=>[e.value.company_type?(l(),c("span",W,r(e.value.company_type),1)):(l(),c("span",Y,r(a.$t("TEXTS.notFound")),1))]),address:d(e=>[e.value.address?(l(),c("span",Z,r(e.value.address),1)):e.value.branches.length?(l(),c("span",ee,r(B(e.value.branches)),1)):(l(),c("span",ae,r(a.$t("TEXTS.notFound")),1))]),show:d(e=>[h(T,{to:`/companies/${e.value.id}`,class:"flex w-[150px] items-center justify-center"},{default:d(()=>n[3]||(n[3]=[p("i",{class:"fa-solid fa-eye"},null,-1)])),_:2},1032,["to"])]),_:1},8,["columns","rows"])],64))]),_:1})}}};export{le as default};
