import{v as W,u as Z,r as v,g as h,l as ee,o as a,c as r,h as b,j as y,w as g,b as te,T as ae,O as se,a as n,p as X,q as D,t as m,n as L,i as w,F as U,N as H,y as C,f as pe,P as me,x as ve,m as K}from"./index-PF4Eq7D6.js";import{h as P}from"./hasPermission-CVzDC8fh.js";import{c as fe}from"./checkPermission-Ceto9Xa7.js";import{h as R}from"./moment-C5S46NFB.js";const xe={class:"rounded-xl border border-light-border bg-white p-3.5 dark:border-dark-border dark:bg-black"},ye={class:"mb-5 flex items-center gap-3 border-b border-light-border pb-2.5 dark:border-dark-border"},ge={class:"flex w-full flex-col md:items-start justify-between gap-3 sm:flex-row items-center"},he={class:"flex max-w-full flex-grow flex-col items-start gap-1.5 sm:max-w-[60%]"},be=["title"],Se=["href","title"],Te={class:"flex flex-col items-start gap-1"},ke={class:"flex items-center gap-1 font-medium text-light-text dark:text-dark-text"},we={key:1,class:"text-sm text-center"},_e={class:"flex flex-col items-start justify-between gap-3 md:flex-row md:items-center"},$e={class:"flex flex-col gap-2"},Le={class:"flex items-center gap-2"},Ee={class:"font-medium text-[#737373] text-sm dark:text-white"},Ie={key:1,class:"capitalize text-light-text text-sm dark:text-dark-text"},Ue={class:"flex items-center gap-2"},Ae={class:"font-medium text-[#737373] text-sm dark:text-white"},Ce={class:"flex items-center gap-1.5"},De={key:2},Q={__name:"UserCard",props:{data:{type:Object,required:!0,default:null},loading:{type:Boolean,required:!1,default:!1}},emits:["refetch"],setup(i,{emit:o}){const u=i,B=W(),q=Z(),E=o,_=v(!1),I=v(!1);async function N(){I.value=!0;let x="";u.data.suspended_at?x="/admin/user/activeUser":x="/admin/user/suspendUser",await H.post(x,{id:u.data.id}).then(()=>{B.success(q.t(`TEXTS.${u.data.suspended_at?"userActivatedSuccessfully":"userSuspendedSuccessfully"}`)),E("refetch"),_.value=!1}).catch(S=>{console.error(S),B.error(S.response.data.Error[0])}).finally(()=>I.value=!1)}return(x,S)=>{const A=h("Modal"),T=h("Skeleton"),$=h("Switcher"),F=ee("tooltip");return a(),r(U,null,[(a(),b(se,{to:"body"},[y(ae,{name:"fade"},{default:g(()=>[_.value?(a(),b(A,{key:0,title:x.$t("TITLES.changeStatus"),text:x.$t("TEXTS.confirmChangeStatus"),btnText:x.$t("BUTTONS.change"),loading:I.value,onClose:S[0]||(S[0]=V=>_.value=!1),onHandleClick:N},null,8,["title","text","btnText","loading"])):te("",!0)]),_:1})])),n("div",xe,[n("div",ye,[n("div",ge,[n("div",he,[i.loading?(a(),b(T,{key:0,class:"mb-2 h-[21px] w-[130px]"})):X((a(),r("h5",{key:1,class:"w-full font-semibold dark:text-white",title:i.data.name},[D(m(i.data.name),1)],8,be)),[[F]]),i.loading?(a(),b(T,{key:2,class:"h-[19px] w-[170px]"})):X((a(),r("a",{key:3,href:`mailto:${i.data.email}`,class:"block w-full truncate text-light-text dark:text-dark-text",title:i.data.email},[D(m(i.data.email),1)],8,Se)),[[F]])]),n("div",Te,[n("div",ke,[S[2]||(S[2]=n("span",{class:"text-[#737373] min-w-[48px] text-sm"},"MLS ID:",-1)),i.loading?(a(),b(T,{key:0,class:"h-[19px] w-[100px]"})):(a(),r("span",we,m(i.data.mls_id||x.$t("TEXTS.notFound")),1))])])])]),n("div",_e,[n("div",$e,[n("div",Le,[n("h5",Ee,m(x.$t("TITLES.type"))+": ",1),i.loading?(a(),b(T,{key:0,class:"h-[21px] w-[120px]"})):(a(),r("span",Ie,m(i.data.application_type?i.data.application_type.name:x.$t("TEXTS.notFound")),1))]),n("div",Ue,[n("span",Ae,m(x.$t("LABELS.status"))+": ",1),i.loading?(a(),b(T,{key:0,class:"h-[21px] w-[100px]"})):(a(),r("span",{key:1,class:L(["capitalize text-sm",[(i.data.status==="pending"||i.data.status==="rejected"||i.data.status==="deactivated")&&"text-primary dark:text-dark-primary",(i.data.status==="new"||i.data.status==="approved"||i.data.status==="active")&&"text-green",i.data.status==="expired"&&"text-yellow-500"]])},m(i.data.status),3))])]),i.loading?(a(),b(T,{key:0,class:"h-[43px] w-[150px] !rounded-[40px]"})):w(P)("Active User")&&w(P)("Suspend User")?(a(),r("div",{key:1,class:L(["flex w-fit items-center gap-5 rounded-[40px] p-2",i.data.suspended_at?"bg-[#DC06061A] dark:bg-[#150204]":"bg-[#12B76A1A] dark:bg-[#02110a]"])},[n("div",Ce,[n("span",{class:L(["size-[8px] rounded-full",i.data.suspended_at?"bg-primary dark:text-dark-primary":"bg-green dark:bg-dark-green"])},null,2),n("span",{class:L(i.data.suspended_at?"text-primary dark:text-dark-primary":"text-green dark:text-dark-green")},m(i.data.suspended_at?x.$t("INPUTS.suspend"):x.$t("INPUTS.active")),3)]),y($,{id:"userStatus",status:!i.data.suspended_at,onChange:S[1]||(S[1]=V=>_.value=!0)},null,8,["status"])],2)):(a(),r("span",De,"_"))])])],64)}}},Be={class:"card-shadow rounded-2xl my-5"},qe={class:"mb-5 grid grid-cols-12 gap-3 lg:mb-7 lg:gap-5"},Ne={class:"col-span-12 xl:col-span-10"},Fe={class:"col-span-12 xl:col-span-5"},Me={class:"col-span-12 xl:col-span-5"},je={class:"col-span-1"},Xe=["disabled"],Pe={key:0,class:"grid grid-cols-12 gap-3 lg:gap-5"},Ve={key:2,class:"col-span-12 text-center font-medium text-light-text dark:text-dark-text"},Ye={key:0,class:"flex items-center justify-center rounded-[10px] bg-white py-10 dark:bg-transparent"},ze={class:"flex items-center justify-end"},Oe={type:"button",class:"mb-5 rounded-full bg-primary px-7 py-3 text-white"},Re=["title"],He=["href","title"],Je={class:"pe-5 capitalize"},Ge={key:0},Ke={key:1,class:"text-light-text dark:text-dark-text"},Qe={class:"flex items-center gap-1.5"},We={key:1},st={__name:"index",setup(i){const o=Z(),u=me(),B=ve(),q=W();function E(s,l){B.push({path:"/mls-users",query:Object.assign({},u.query,{[s]:l})})}const _=v(u.query.name||"");C(_,s=>{E("name",s)});const I=v(u.query.status||""),N=v([{id:"pending",name:o.t("LABELS.pending")},{id:"rejected",name:o.t("LABELS.rejected")},{id:"deactivated",name:o.t("LABELS.deactivated")},{id:"new",name:o.t("LABELS.new")},{id:"approved",name:o.t("LABELS.approved")},{id:"active",name:o.t("INPUTS.active")},{id:"expired",name:o.t("LABELS.expired")}]);C(I,s=>{var e;const l=(e=N.value.find(d=>d.name===s))==null?void 0:e.id;E("status",l)});const x=v(u.query.order||""),S=v([{id:"new",name:o.t("LABELS.new")},{id:"old",name:o.t("LABELS.old")}]);C(x,s=>{var e;const l=(e=S.value.find(d=>d.name===s))==null?void 0:e.id;E("order",l)});const A=v(u.query.status||""),T=v([{id:"broker",name:o.t("LABELS.broker")},{id:"developer",name:o.t("INPUTS.developer")}]);C(A,s=>{var e;const l=(e=T.value.find(d=>d.name===s))==null?void 0:e.id;E("user_type",l)});const $=v(u.query.view||"row");function F(){$.value==="row"?$.value="table":$.value="row",E("view",$.value)}const V=v(0),M=v([]),c=v({columns:[{label:o.t("TITLES.user"),field:"name",sortable:!0},{label:"MLS ID",field:"mls_id",sortable:!0},{label:o.t("TITLES.email"),field:"email",sortable:!0},{label:o.t("TITLES.userType"),field:"user_type",sortable:!0},{label:o.t("LABELS.status"),field:"status",sortable:!0},{label:o.t("TITLES.expirationDate"),field:"expiration_date",sortable:!0},{label:o.t("TITLES.registrationDate"),field:"created_at",sortable:!0},{label:o.t("TITLES.action"),field:"active"}],rows:[],sortable:{order:"",sort:"asc"}}),J=v([]);function le(s,l,e,d){c.value.isReSearch=s==null,d=="asc"?e==="name"||e==="email"||e==="user_type"||e==="status"?c.value.rows=c.value.rows.slice().sort((p,f)=>p[e]<f[e]?-1:p[e]>f[e]?1:0):e==="created_at"||e==="expiration_date"?c.value.rows=c.value.rows.sort((p,f)=>new Date(p[e])-new Date(f[e])):c.value.rows=c.value.rows.sort((p,f)=>p[e]-f[e]):e==="name"||e==="email"||e==="user_type"||e==="status"?c.value.rows=c.value.rows.slice().sort((p,f)=>p[e]>f[e]?-1:p[e]<f[e]?1:0):e==="created_at"||e==="expiration_date"?c.value.rows=c.value.rows.sort((p,f)=>new Date(f[e])-new Date(p[e])):c.value.rows=c.value.rows.sort((p,f)=>f[e]-p[e]),c.value.sortable.order=e,c.value.sortable.sort=d}const k=v(!1);async function Y(){k.value=!0;const s={search:u.query.name||"",status:u.query.status||""};u.query.order&&u.query.order!=="old"&&(s.order=u.query.order),u.query.user_type&&(s.application_type_name=u.query.user_type),await H.get("/admin/user/listNonAdminUsers",{params:s}).then(l=>{c.value.rows=l.data.data,c.value.rows.forEach(e=>{var p;const d={};d[o.t("TITLES.user")]=e.name,d["MLS ID"]=e.mls_id||o.t("TEXTS.notFound"),d[o.t("TITLES.email")]=e.email,d[o.t("TITLES.userType")]=((p=e.application_type)==null?void 0:p.name)||o.t("TEXTS.notFound"),d[o.t("LABELS.status")]=e.status,d[o.t("TITLES.expirationDate")]=e.expiration_date?R(e.expiration_date).format("YYYY-MM-DD"):o.t("TEXTS.notFound"),J.value.push(d)}),M.value=l.data.data}).catch(l=>console.error(l)).finally(()=>k.value=!1)}const j=v(!1),z=v(null),O=v(!1);async function ne(){const s=M.value.find(l=>l.id===z.value);if(s){let l="";const e=s.suspended_at;e?l="/admin/user/activeUser":l="/admin/user/suspendUser",O.value=!0,await H.post(l,{id:z.value}).then(()=>{q.success(o.t(`TEXTS.${e?"userActivatedSuccessfully":"userSuspendedSuccessfully"}`)),Y(),j.value=!1}).catch(d=>{console.error(d),q.error(d.response.data.Error[0])}).finally(()=>O.value=!1)}}return C(()=>u.query,()=>{Y()},{deep:!0,immediate:!0}),pe(()=>{fe("Filter Non Admin")}),(s,l)=>{const e=h("Modal"),d=h("Search"),p=h("Select"),f=h("SvgIcon"),oe=h("Loader"),ie=h("JsonExcel"),re=h("Switcher"),de=h("Table"),ue=h("Card"),G=ee("tooltip");return a(),r(U,null,[(a(),b(se,{to:"body"},[y(ae,{name:"fade"},{default:g(()=>[j.value?(a(),b(e,{key:0,title:s.$t("TITLES.changeStatus"),text:s.$t("TEXTS.confirmChangeStatus"),btnText:s.$t("BUTTONS.change"),loading:O.value,onClose:l[0]||(l[0]=t=>j.value=!1),onHandleClick:ne},null,8,["title","text","btnText","loading"])):te("",!0)]),_:1})])),n("div",Be,[y(ue,{loading:k.value,number:V.value},{default:g(()=>[n("div",qe,[n("div",Ne,[y(d,{modelValue:_.value,"onUpdate:modelValue":l[1]||(l[1]=t=>_.value=t),placeholder:s.$t("INPUTS.mlsUsersSearch"),disabled:k.value},null,8,["modelValue","placeholder","disabled"])]),n("div",Fe,[y(p,{id:"statusFilter",label:s.$t("LABELS.status"),placeholder:s.$t("INPUTS.select"),defaultValue:w(u).query.status||"",disabled:k.value,options:N.value,clearable:!0,onSelect:l[2]||(l[2]=t=>I.value=t),onClear:l[3]||(l[3]=t=>I.value="")},null,8,["label","placeholder","defaultValue","disabled","options"])]),n("div",Me,[y(p,{id:"userTypesFilter",label:s.$t("TITLES.userType"),placeholder:s.$t("INPUTS.select"),defaultValue:w(u).query.user_type||"",disabled:k.value,options:T.value,clearable:!0,onSelect:l[4]||(l[4]=t=>A.value=t),onClear:l[5]||(l[5]=t=>A.value="")},null,8,["label","placeholder","defaultValue","disabled","options"])]),n("div",je,[n("button",{type:"button",class:"flex size-[45px] items-center justify-center rounded-lg border border-light-border disabled:cursor-not-allowed disabled:opacity-60 dark:border-dark-border",disabled:k.value,onClick:F},[$.value==="row"?(a(),b(f,{key:0,icon:"bars"})):(a(),b(f,{key:1,icon:"row"}))],8,Xe)])]),$.value==="row"?(a(),r("div",Pe,[k.value?(a(),r(U,{key:0},K(15,t=>n("div",{key:t,class:"col-span-12 md:col-span-6 2xl:col-span-4"},[y(Q,{data:{},loading:""})])),64)):M.value.length?(a(!0),r(U,{key:1},K(M.value,t=>(a(),r("div",{key:t.id,class:"col-span-12 items-start md:col-span-6 2xl:col-span-4"},[y(Q,{data:t,onRefetch:l[6]||(l[6]=ce=>Y())},null,8,["data"])]))),128)):(a(),r("p",Ve,m(s.$t("TEXTS.noUsers")),1))])):(a(),r(U,{key:1},[k.value?(a(),r("div",Ye,[y(oe)])):(a(),r(U,{key:1},[n("div",ze,[y(ie,{data:J.value,rtl:w(o).locale.value==="ar",name:"MLS Users",class:"w-fit"},{default:g(()=>[n("button",Oe,m(s.$t("BUTTONS.exportData")),1)]),_:1},8,["data","rtl"])]),y(de,{"is-slot-mode":!0,columns:c.value.columns,rows:c.value.rows,sortable:{sort:"asc"},onDoSearch:le,pagination:!1,"is-hide-paging":!0,class:"font-medium"},{name:g(t=>[X((a(),r("h5",{class:"max-w-[150px] truncate",title:t.value.name.replace(/<|>/g,"")},[D(m(t.value.name.replace(/<|>/g,"")),1)],8,Re)),[[G]])]),mls_id:g(t=>[D(m(t.value.mls_id||s.$t("TEXTS.notFound")),1)]),email:g(t=>[X((a(),r("a",{href:`mailto:${t.value.email}`,class:"inline-block max-w-[130px] truncate",title:t.value.email},[D(m(t.value.email),1)],8,He)),[[G]])]),user_type:g(t=>[n("span",Je,m(t.value.application_type?t.value.application_type.name:s.$t("TEXTS.notFound")),1)]),status:g(t=>[n("span",{class:L(["capitalize",[(t.value.status==="pending"||t.value.status==="rejected"||t.value.status==="deactivated")&&"text-primary dark:text-dark-primary",(t.value.status==="new"||t.value.status==="approved"||t.value.status==="active")&&"text-green",t.value.status==="expired"&&"text-yellow-500"]])},m(t.value.status),3)]),expiration_date:g(t=>[t.value.expiration_date?(a(),r("span",Ge,m(w(R)(t.value.expiration_date).format("YYYY-MM-DD")),1)):(a(),r("span",Ke,m(s.$t("TEXTS.notFound")),1))]),created_at:g(t=>[n("span",null,m(w(R)(t.value.created_at).format("YYYY-MM-DD")),1)]),active:g(t=>[w(P)("Active User")&&w(P)("Suspend User")?(a(),r("div",{key:0,class:L(["flex w-fit min-w-[165px] items-center justify-between gap-5 rounded-[40px] px-2 py-3",t.value.suspended_at?"bg-[#DC06061A]":"bg-[#12B76A1A]"])},[n("div",Qe,[n("span",{class:L(["size-[8px] rounded-full",t.value.suspended_at?"bg-primary dark:bg-dark-primary":"bg-green"])},null,2),n("span",{class:L(t.value.suspended_at?"text-primary dark:text-dark-primary":"text-green")},m(t.value.suspended_at?s.$t("INPUTS.suspend"):s.$t("INPUTS.active")),3)]),y(re,{id:"userStatus",status:!t.value.suspended_at,onChange:ce=>{z.value=t.value.id,j.value=!0}},null,8,["status","onChange"])],2)):(a(),r("span",We,"_"))]),_:1},8,["columns","rows"])],64))],64))]),_:1},8,["loading","number"])])],64)}}};export{st as default};
