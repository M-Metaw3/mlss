import{u as me,v as pe,r,g,l as fe,o as t,c as o,h as m,j as c,w as k,b as L,T as J,O as G,a as s,t as v,i as b,n as U,p as j,q as F,N,U as Le,y as B,f as Ue,F as M,P as Re,x as Ae,m as ue}from"./index-PF4Eq7D6.js";import{c as Ce}from"./checkPermission-Ceto9Xa7.js";import{h as w}from"./hasPermission-CVzDC8fh.js";import{c as Ie,a as O}from"./index.esm-Bil5A8ED.js";import{h as oe}from"./moment-C5S46NFB.js";const Be={class:"rounded-lg border border-light-border dark:border-dark-border"},Ne={class:"flex flex-col items-start justify-between gap-3 border-b border-light-border p-3 dark:border-dark-border lg:flex-row lg:items-center"},qe={key:1,class:"inline-block w-full text-light-text dark:text-dark-text"},Ve={class:"flex items-center gap-3"},De={key:2},Pe={key:5},Me={class:"p-3"},Oe={class:"mb-3 flex flex-col items-start justify-between border-b border-light-border pb-3 dark:border-dark-border lg:flex-row lg:items-center"},je={class:"mb-2 flex w-full max-w-full flex-col items-start gap-2 lg:mb-0 lg:max-w-[50%]"},Fe={key:1,class:"font-medium"},Ye={key:3,class:"text-light-text dark:text-dark-text"},Xe={class:"flex items-center gap-1.5"},ze={key:2},He={class:"flex w-full flex-col items-start gap-2.5 text-sm text-light-text dark:text-dark-text"},Je={class:"flex w-full flex-col items-start justify-between gap-1 lg:flex-row lg:items-center lg:gap-2"},Ge=["href","title"],Ke={class:"flex w-full flex-col items-start justify-between gap-1 lg:flex-row lg:items-center lg:gap-2"},Qe=["title"],ce={__name:"SystemUserCard",props:{loading:{type:Boolean,required:!1,default:!1},data:{type:Object,required:!0,default:null}},emits:["edit","delete","refetch"],setup(d,{emit:n}){const T=d,p=n,K=me(),E=pe(),_=r(!1),R=r(!1);async function q(){R.value=!0;let y="";T.data.suspended_at?y="/admin/user/activeUser":y="/admin/user/suspendUser",await N.post(y,{id:T.data.id}).then(()=>{E.success(K.t(`TEXTS.${T.data.suspended_at?"userActivatedSuccessfully":"userSuspendedSuccessfully"}`)),p("refetch"),_.value=!1}).catch(f=>{console.error(f),E.error(f.response.data.Error[0])}).finally(()=>R.value=!1)}return(y,f)=>{const Y=g("Modal"),h=g("Skeleton"),Q=g("Switcher"),S=fe("tooltip");return t(),o("div",Be,[(t(),m(G,{to:"body"},[c(J,{name:"fade"},{default:k(()=>[_.value?(t(),m(Y,{key:0,title:y.$t("TITLES.changeStatus"),text:y.$t("TEXTS.confirmChangeStatus"),btnText:y.$t("BUTTONS.change"),loading:R.value,onClose:f[0]||(f[0]=x=>_.value=!1),onHandleClick:q},null,8,["title","text","btnText","loading"])):L("",!0)]),_:1})])),s("div",Ne,[d.loading?(t(),m(h,{key:0,class:"h-[21px] w-full"})):(t(),o("span",qe,v(b(oe)(d.data.created_at).format("ddd MMM DD YYYY")),1)),s("div",Ve,[d.loading?(t(),m(h,{key:0,class:"size-[30px] !rounded-full"})):b(w)("Update Admin")?(t(),o("button",{key:1,type:"button",onClick:f[1]||(f[1]=x=>p("edit")),class:"text-light-text dark:text-dark-text"},f[4]||(f[4]=[s("i",{class:"fa-solid fa-edit"},null,-1)]))):(t(),o("span",De,"_")),d.loading?(t(),m(h,{key:3,class:"size-[30px] !rounded-full"})):b(w)("Delete Admin")?(t(),o("button",{key:4,type:"button",onClick:f[2]||(f[2]=x=>p("delete"))},f[5]||(f[5]=[s("i",{class:"fa-solid fa-trash-alt text-primary dark:text-dark-primary"},null,-1)]))):(t(),o("span",Pe,"_"))])]),s("div",Me,[s("div",Oe,[s("div",je,[d.loading?(t(),m(h,{key:0,class:"h-[21px] w-full"})):(t(),o("span",Fe,v(d.data.name),1)),d.loading?(t(),m(h,{key:2,class:"h-[21px] w-full"})):(t(),o("span",Ye,v(d.data.roles.map(x=>x.name).join(", ")),1))]),d.loading?(t(),m(h,{key:0,class:"h-[43px] w-[150px] !rounded-[40px]"})):b(w)("Active User")&&b(w)("Suspend User")?(t(),o("div",{key:1,class:U(["flex w-fit items-center gap-5 rounded-[40px] p-2",d.data.suspended_at?"bg-[#DC06061A] dark:bg-[#150204]":"bg-[#12B76A1A] dark:bg-[#02110a]"])},[s("div",Xe,[s("span",{class:U(["size-[8px] rounded-full",d.data.suspended_at?"bg-primary dark:text-dark-primary":"bg-green dark:bg-dark-green"])},null,2),s("span",{class:U(d.data.suspended_at?"text-primary dark:text-dark-primary":"text-green dark:text-dark-green")},v(d.data.suspended_at?y.$t("INPUTS.suspend"):y.$t("INPUTS.active")),3)]),c(Q,{id:"userStatus",status:!d.data.suspended_at,onChange:f[3]||(f[3]=x=>_.value=!0)},null,8,["status"])],2)):(t(),o("span",ze,"_"))]),s("div",He,[s("div",Je,[s("h5",null,v(y.$t("LABELS.phoneNumber")),1),d.loading?(t(),m(h,{key:0,class:"h-[21px] w-full lg:w-[40%]"})):j((t(),o("a",{key:1,href:`to:${d.data.phone}`,class:"max-w-full truncate lg:max-w-[40%]",title:d.data.phone},[F(v(d.data.phone),1)],8,Ge)),[[S]])]),s("div",Ke,[s("h5",null,v(y.$t("TITLES.email")),1),d.loading?(t(),m(h,{key:0,class:"h-[21px] w-full lg:w-[40%]"})):j((t(),o("a",{key:1,href:"mailto:",class:"max-w-full truncate lg:max-w-[40%]",title:d.data.email},[F(v(d.data.email),1)],8,Qe)),[[S]])])])])])}}},We={class:"grid w-full grid-cols-1 gap-3 lg:grid-cols-2"},Ze={class:"mb-5 grid grid-cols-12 gap-3 lg:mb-7 lg:gap-5"},et={class:"col-span-12 xl:col-span-4"},tt={class:"col-span-12 xl:col-span-4"},at={class:"col-span-12 xl:col-span-4"},lt={class:"col-span-12 xl:col-span-4"},st={class:"col-span-8 flex gap-2 justify-end"},nt=["disabled"],ot=["disabled"],rt={key:0,class:"flex items-center justify-center rounded-[10px] bg-white py-10 dark:bg-transparent"},dt={key:0,class:"flex items-center justify-end"},it={type:"button",class:"mb-5 rounded-full bg-primary px-7 py-3 text-white"},ut={class:"flex max-w-[130px] flex-col items-start gap-1"},ct=["title"],mt=["title"],pt={class:"pe-10 capitalize"},ft=["href"],vt={class:"flex items-center gap-1.5"},gt={key:1},ht=["href","title"],bt={class:"flex items-center gap-3 px-5"},yt=["onClick"],kt={key:1},St=["onClick"],xt={key:3},Tt={key:2,class:"text-light-text dark:text-dark-text"},wt={key:1,class:"grid grid-cols-1 items-start gap-3 md:grid-cols-2 lg:gap-5 2xl:grid-cols-3"},$t={key:2,class:"text-light-text dark:text-dark-text"},At={__name:"index",setup(d){Le({validateOnBlur:!0,validateOnChange:!0,validateOnInput:!0,validateOnModelUpdate:!0});const n=me(),T=pe(),p=Re(),K=Ae();function E(e,a){K.push({path:"/system-users",query:Object.assign({},p.query,{[e]:a})})}const _=r(p.query.search||"");B(_,e=>{E("search",e)});const R=r(p.query.email||"");B(R,e=>{E("email",e)});const q=r(p.query.status||""),y=r([{id:"active",name:n.t("INPUTS.active")},{id:"deactive",name:n.t("LABELS.deactivated")}]);B(q,e=>{var i;const a=(i=y.value.find(u=>u.name===e))==null?void 0:i.id;E("status",a)});const f=r(p.query.order||""),Y=r([{id:"new",name:n.t("LABELS.new")},{id:"old",name:n.t("LABELS.old")}]);B(f,e=>{var i;const a=(i=Y.value.find(u=>u.name===e))==null?void 0:i.id;E("order",a)});const h=r(p.query.view||"row");function Q(){h.value==="row"?h.value="table":h.value="row",E("view",h.value)}const S=r(!1),x=r({columns:[{label:n.t("TITLES.user"),field:"user"},{label:n.t("TITLES.creationDate"),field:"date"},{label:n.t("TITLES.roles"),field:"roles"},{label:n.t("LABELS.phoneNumber"),field:"phone"},{label:n.t("LABELS.status"),field:"status"},{label:n.t("TITLES.email"),field:"email"},{label:"",field:"control"}],rows:[]}),X=r([]),re=r([]);async function V(){S.value=!0;const e={search:p.query.search||"",email:p.query.email||"",status:p.query.status||""};p.query.order&&p.query.order!=="old"&&(e.order=p.query.order),await N.get("/admin/user/listAdminUsers",{params:e}).then(a=>{x.value.rows=a.data.data,X.value=a.data.data,x.value.rows.forEach(i=>{const u={};u[n.t("TITLES.user")]=i.name,u[n.t("TITLES.creationDate")]=i.created_at?oe(i.date).format("YYYY-MM-DD"):n.t("TEXTS.notFound"),u[n.t("TITLES.roles")]=i.roles.map(C=>C.name).join(", "),u[n.t("LABELS.phoneNumber")]=i.phone,u[n.t("LABELS.status")]=i.status,u[n.t("TITLES.email")]=i.email,re.value.push(u)})}).catch(a=>console.error(a)).finally(()=>S.value=!1)}const A=r(!1),$=r(null),D=r({}),ve=Ie().shape({name:O().required(n.t("ERRORS.nameRequired")),email:O().required(n.t("ERRORS.emailRequired")).email(n.t("ERRORS.invalidEmail")),phone:O().required(n.t("ERRORS.phoneNumberRequired")).min(10,n.t("ERRORS.phoneMinLength")).max(11,n.t("ERRORS.phoneMaxLength")),role:O().required(n.t("ERRORS.roleRequired")),password:O().required(n.t("ERRORS.passwordRequired")).test("password",n.t("ERRORS.passwordMinLength"),e=>e?e.length>=6:!1)});B($,e=>{e?D.value={name:e.name,email:e.email,phone:e.phone,role:e.roles[0].id}:D.value={}});const z=r(!1);async function ge(e){z.value=!0;let a;const i={name:e.name,email:e.email,password:e.password,phone:e.phone,roles:[ee.value.find(u=>u.id==e.role).name]};$.value?(a="/admin/user/updateAdminUser",i.id=$.value.id):a="/admin/user/createAdminUser",await N.post(a,i).then(()=>{T.success(n.t(`TEXTS.${$.value?"userUpdatedSuccessfully":"userAddedSuccessfully"}`)),V(),A.value=!1,$.value=null}).catch(u=>{console.error(u),T.error(u.response.data.Error[0])}).finally(()=>z.value=!1)}const P=r(!1),W=r(null),Z=r(!1);async function he(){Z.value=!0,await N.post("/admin/user/deleteAdminUser",{id:W.value}).then(()=>{V(),P.value=!1,T.success(n.t("TEXTS.userDeletedSuccessfully"))}).catch(e=>{console.error(e),T.error(e.response.data.Error[0])}).finally(()=>Z.value=!1)}const ee=r([]),te=r(!1);async function be(){te.value=!0,await N.get("/admin/roles-permissions/listPermissionsRoles").then(e=>{ee.value=e.data.data.roles.map(a=>({id:a.id,name:a.name}))}).catch(e=>console.error(e.response.data.Error[0])).finally(()=>te.value=!1)}const H=r(!1),ae=r(null),le=r(!1);async function ye(){const e=X.value.find(a=>a.id===ae.value);if(e){let a="";const i=e.suspended_at;i?a="/admin/user/activeUser":a="/admin/user/suspendUser",le.value=!0,await N.post(a,{id:ae.value}).then(()=>{T.success(n.t(`TEXTS.${i?"userActivatedSuccessfully":"userSuspendedSuccessfully"}`)),V(),H.value=!1}).catch(u=>{console.error(u),T.error(u.response.data.Error[0])}).finally(()=>le.value=!1)}}return B(()=>p.query,()=>{V()},{deep:!0,immediate:!0}),Ue(()=>{Ce("List Admin"),w("List All Roles & Permissions")&&be()}),(e,a)=>{const i=g("Modal"),u=g("Background"),C=g("ValidInput"),ke=g("ValidSelect"),Se=g("FormModal"),de=g("Search"),ie=g("Select"),se=g("SvgIcon"),xe=g("Loader"),Te=g("JsonExcel"),we=g("Switcher"),$e=g("Table"),Ee=g("Card"),ne=fe("tooltip");return t(),o(M,null,[(t(),m(G,{to:"body"},[c(J,{name:"fade"},{default:k(()=>[H.value?(t(),m(i,{key:0,title:e.$t("TITLES.changeStatus"),text:e.$t("TEXTS.confirmChangeStatus"),btnText:e.$t("BUTTONS.change"),loading:le.value,onClose:a[0]||(a[0]=l=>H.value=!1),onHandleClick:ye},null,8,["title","text","btnText","loading"])):L("",!0)]),_:1})])),(t(),m(G,{to:"body"},[A.value?(t(),m(u,{key:0})):L("",!0),c(J,{name:"translate"},{default:k(()=>[A.value?(t(),m(Se,{key:0,title:e.$t(`TITLES.${$.value?"editUser":"addNewUser"}`),loading:z.value,schema:b(ve),initialValues:D.value,btnText:e.$t("BUTTONS.save"),onClose:a[1]||(a[1]=l=>{A.value=!1,$.value=null}),onSubmit:ge},{default:k(()=>[s("div",We,[c(C,{id:"name",label:e.$t("LABELS.name"),class:"lg:col-span-2",placeholder:e.$t("INPUTS.namePlaceholder"),name:"name"},null,8,["label","placeholder"]),c(C,{id:"email",type:"email",label:e.$t("TITLES.email"),placeholder:e.$t("INPUTS.emailPlaceholder"),name:"email"},null,8,["label","placeholder"]),c(C,{id:"phoneNumber",label:e.$t("LABELS.phoneNumber"),placeholder:e.$t("INPUTS.phonePlaceholder"),isNumber:"",name:"phone"},null,8,["label","placeholder"]),c(ke,{id:"role",class:"lg:col-span-2",label:e.$t("LABELS.role"),name:"role",loading:te.value||z.value,placeholder:e.$t("INPUTS.rolePlaceholder"),defaultValue:D.value.role?D.value.role:"",options:ee.value},null,8,["label","loading","placeholder","defaultValue","options"]),c(C,{id:"password",type:"password",label:e.$t("LABELS.password"),class:"lg:col-span-2",placeholder:e.$t("INPUTS.passwordPlaceholder"),name:"password"},null,8,["label","placeholder"])])]),_:1},8,["title","loading","schema","initialValues","btnText"])):L("",!0)]),_:1})])),(t(),m(G,{to:"body"},[c(J,{name:"fade"},{default:k(()=>[P.value?(t(),m(i,{key:0,title:e.$t("TITLES.deleteUser"),text:e.$t("TEXTS.confirmDeleteUser"),btnText:e.$t("BUTTONS.delete"),loading:Z.value,onClose:a[2]||(a[2]=l=>P.value=!1),onHandleClick:he},null,8,["title","text","btnText","loading"])):L("",!0)]),_:1})])),c(Ee,{class:"card-shadow my-5"},{default:k(()=>[s("div",Ze,[s("div",et,[c(de,{modelValue:_.value,"onUpdate:modelValue":a[3]||(a[3]=l=>_.value=l),disabled:S.value,placeholder:e.$t("INPUTS.systemUsersSearch")},null,8,["modelValue","disabled","placeholder"])]),s("div",tt,[c(de,{modelValue:R.value,"onUpdate:modelValue":a[4]||(a[4]=l=>R.value=l),disabled:S.value,placeholder:e.$t("TITLES.email")},null,8,["modelValue","disabled","placeholder"])]),s("div",at,[c(ie,{id:"statusFilter",label:e.$t("LABELS.status"),placeholder:e.$t("INPUTS.select"),defaultValue:b(p).query.status||"",disabled:S.value,options:y.value,clearable:!0,onSelect:a[5]||(a[5]=l=>q.value=l),onClear:a[6]||(a[6]=l=>q.value="")},null,8,["label","placeholder","defaultValue","disabled","options"])]),s("div",lt,[c(ie,{id:"orderFilter",label:e.$t("TITLES.order"),placeholder:e.$t("INPUTS.select"),defaultValue:b(p).query.order||"",disabled:S.value,options:Y.value,clearable:!0,onSelect:a[7]||(a[7]=l=>f.value=l),onClear:a[8]||(a[8]=l=>f.value="")},null,8,["label","placeholder","defaultValue","disabled","options"])]),s("div",st,[s("button",{type:"button",class:"flex size-[45px] items-center justify-center rounded-lg border border-light-border disabled:cursor-not-allowed disabled:opacity-60 dark:border-dark-border",disabled:S.value,onClick:Q},[h.value==="row"?(t(),m(se,{key:0,icon:"bars"})):(t(),m(se,{key:1,icon:"row"}))],8,nt),b(w)("Create Admin")?(t(),o("button",{key:0,type:"button",class:"flex px-3 gap-2 items-center bg-primary text-white justify-center rounded-lg border border-light-border disabled:cursor-not-allowed disabled:opacity-60 dark:border-dark-border",disabled:S.value,onClick:a[9]||(a[9]=l=>A.value=!0)},[a[10]||(a[10]=s("h3",null,"Add Admin",-1)),c(se,{class:"stroke-white",icon:"add"})],8,ot)):L("",!0)])]),h.value==="table"?(t(),o(M,{key:0},[S.value?(t(),o("div",rt,[c(xe)])):x.value.rows.length?(t(),o(M,{key:1},[x.value.rows.length?(t(),o("div",dt,[c(Te,{data:re.value,rtl:b(n).locale.value==="ar",name:"System Users"},{default:k(()=>[s("button",it,v(e.$t("BUTTONS.exportData")),1)]),_:1},8,["data","rtl"])])):L("",!0),c($e,{"is-slot-mode":!0,columns:x.value.columns,rows:x.value.rows,pagination:!1,"is-hide-paging":!0,class:"font-medium"},{user:k(l=>[s("div",ut,[j((t(),o("h5",{class:"w-full truncate",title:l.value.name},[F(v(l.value.name),1)],8,ct)),[[ne]]),l.value.mls_id?j((t(),o("span",{key:0,class:"inline-block truncate text-sm font-normal",title:l.value.mls_id},[F("@"+v(l.value.mls_id),1)],8,mt)),[[ne]]):L("",!0)])]),date:k(l=>[s("span",null,v(b(oe)(l.value.created_at).format("YYYY-MM-DD")),1)]),roles:k(l=>[s("span",pt,v(l.value.roles.map(I=>I.name).join(", ")),1)]),phone:k(l=>[s("a",{href:`tel:${l.value.phone}`},v(l.value.phone),9,ft)]),status:k(l=>[b(w)("Active User")&&b(w)("Suspend User")?(t(),o("div",{key:0,class:U(["flex w-fit min-w-[165px] items-center justify-between gap-5 rounded-[40px] px-2 py-3",l.value.suspended_at?"bg-[#DC06061A]":"bg-[#12B76A1A]"])},[s("div",vt,[s("span",{class:U(["size-[8px] rounded-full",l.value.suspended_at?"bg-primary dark:bg-dark-primary":"bg-green"])},null,2),s("span",{class:U(l.value.suspended_at?"text-primary dark:text-dark-primary":"text-green")},v(l.value.suspended_at?e.$t("INPUTS.suspend"):e.$t("INPUTS.active")),3)]),c(we,{id:"userStatus",status:!l.value.suspended_at,onChange:I=>{ae.value=l.value.id,H.value=!0}},null,8,["status","onChange"])],2)):(t(),o("span",gt,"_"))]),email:k(l=>[j((t(),o("a",{href:`mailto:${l.value.email}`,class:"inline-block max-w-[130px] truncate",title:l.value.email},[F(v(l.value.email),1)],8,ht)),[[ne]])]),control:k(l=>[s("div",bt,[b(w)("Update Admin")?(t(),o("button",{key:0,type:"button",onClick:I=>{$.value=l.value,A.value=!0}},a[11]||(a[11]=[s("i",{class:"fa-solid fa-edit"},null,-1)]),8,yt)):(t(),o("span",kt,"_")),b(w)("Delete Admin")?(t(),o("button",{key:2,type:"button",onClick:I=>{W.value=l.value.id,P.value=!0}},a[12]||(a[12]=[s("i",{class:"fa-solid fa-trash-alt text-primary dark:text-dark-primary"},null,-1)]),8,St)):(t(),o("span",xt,"_"))])]),_:1},8,["columns","rows"])],64)):(t(),o("p",Tt,v(e.$t("TEXTS.notFound")),1))],64)):(t(),o("div",wt,[S.value?(t(),o(M,{key:0},ue(10,l=>c(ce,{key:l,loading:"",data:{},class:U(l%2==0?"bg-white dark:bg-dark-bodyBg lg:bg-transparent dark:lg:bg-black":"bg-white dark:bg-dark-bodyBg")},null,8,["class"])),64)):X.value.length?(t(!0),o(M,{key:1},ue(X.value,(l,I)=>(t(),m(ce,{key:l.id,data:l,class:U(I%2!==0?"bg-white dark:bg-dark-bodyBg lg:bg-transparent dark:lg:bg-black":"bg-white dark:bg-dark-bodyBg"),onEdit:_e=>{$.value=l,A.value=!0},onDelete:_e=>{W.value=l.id,P.value=!0},onRefetch:V},null,8,["data","class","onEdit","onDelete"]))),128)):(t(),o("p",$t,v(e.$t("TEXTS.notFound")),1))]))]),_:1})],64)}}};export{At as default};
