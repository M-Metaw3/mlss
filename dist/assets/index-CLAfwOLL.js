import{d as O,g as w,o as v,c as T,a as l,t as h,j as M,n as Y,u as P,r as f,f as z,h as E,w as b,N as $,l as J,m as R,F as G,i as N,b as H,q as F,p as X}from"./index-PF4Eq7D6.js";import{h as m}from"./moment-C5S46NFB.js";import{h as V}from"./hasPermission-CVzDC8fh.js";const q={class:"font-light mb-1"},W={class:"insight-card-icon"},K=O({__name:"InsightsCard",props:{insight:{},index:{}},setup(A){return(n,x)=>{const S=w("VsxIcon");return v(),T("div",{class:Y(["insight-card",{gredient1:n.index%2==0,gredient2:n.index%2!=0}])},[l("div",null,[l("h4",q,h(n.insight.insightTitle),1),l("h1",null,h(n.insight.insightValue),1)]),l("div",W,[M(S,{iconName:n.insight.insightIcon,size:28,color:"#FFFFFF",type:"linear"},null,8,["iconName"])])],2)}}}),Q={class:"mb-5 flex flex-wrap gap-3"},Z={class:"mb-5 rounded-xl bg-white card-shadow dark:border-dark-border dark:bg-black"},tt={class:"flex flex-col items-start justify-between gap-5 border-b border-light-border p-3 dark:border-dark-border lg:p-5 xl:flex-row xl:items-center"},et={class:"text-title font-medium text-light-text dark:text-dark-text"},at={class:"flex w-full flex-col items-center justify-between gap-3 md:flex-row xl:w-auto"},st=["disabled"],lt=["disabled"],nt=["disabled"],ot=["disabled"],it={class:"p-3 lg:p-5"},rt={key:0,class:"flex items-center justify-center py-20"},ut={class:"rounded-xl card-shadow bg-white dark:border-dark-border dark:bg-black"},dt={class:"p-3 lg:p-5"},ct={class:"mb-5 flex flex-col items-start justify-between gap-3 lg:flex-row lg:items-center"},ht={class:"font-medium text-light-text dark:text-dark-text"},pt={class:"flex items-center gap-3"},mt={key:0,class:"flex items-center justify-end"},ft={type:"button",class:"rounded-full bg-primary px-7 py-3 text-white"},vt={key:0,class:"flex items-center justify-center rounded-[10px] bg-white py-10 dark:bg-transparent"},_t=["title"],gt={class:"capitalize"},xt={__name:"index",setup(A){const n=P(),x=f([{insightTitle:n.t("TITLES.totalActiveUsers"),insightValue:0,insightIcon:"TrendUp"},{insightTitle:n.t("TITLES.totalPendingUsers"),insightValue:0,insightIcon:"TrendDown"},{insightTitle:n.t("TITLES.totalAcceptedUsers"),insightValue:0,insightIcon:"TrendUp"},{insightTitle:n.t("TITLES.totalRejectedUsers"),insightValue:0,insightIcon:"TrendDown"}]),S=f([]),s=f({columns:[{label:n.t("TITLES.user"),field:"user",sortable:!0},{label:"MLS ID",field:"mls_id",sortable:!0},{label:n.t("LABELS.status"),field:"payment_status",sortable:!0},{label:n.t("LABELS.totalPrice"),field:"total_price",sortable:!0},{label:n.t("TITLES.date"),field:"updated_at",sortable:!0},{label:n.t("TITLES.purchaseType"),field:"purchase_type",sortable:!0}],rows:[],sortable:{order:"",sort:"asc"}});function U(e,r,t,d){s.value.isReSearch=e==null,d=="asc"?t==="mls_id"?s.value.rows=s.value.rows.sort((o,i)=>o.user[t]-i.user[t]):t==="payment_status"||t==="user"||t==="purchase_type"?s.value.rows=s.value.rows.slice().sort((o,i)=>o[t]<i[t]?-1:o[t]>i[t]?1:0):t==="updated_at"?s.value.rows=s.value.rows.sort((o,i)=>new Date(o[t])-new Date(i[t])):s.value.rows=s.value.rows.sort((o,i)=>o[t]-i[t]):t==="mls_id"?s.value.rows=s.value.rows.sort((o,i)=>i.user.mls_id-o.user.mls_id):t==="payment_status"||t==="purchase_type"?s.value.rows=s.value.rows.slice().sort((o,i)=>i[t]<o[t]?1:i[t]>o[t]?-1:0):t==="updated_at"?s.value.rows=s.value.rows.sort((o,i)=>new Date(i[t])-new Date(o[t])):s.value.rows=s.value.rows.sort((o,i)=>i[t]-o[t]),s.value.sortable.order=t,s.value.sortable.sort=d}const L=f(!1);async function j(){L.value=!0,await $.get("/admin/Insights/generalInsights",{params:{start_date:m().subtract(6,"days").format("YYYY-MM-DD"),end_date:m().format("YYYY-MM-DD")}}).then(e=>{const r=e.data.data;x.value[0].insightValue=r.total_active_users,x.value[1].insightValue=r.total_pending_users,x.value[2].insightValue=r.total_accepted_users,x.value[3].insightValue=r.total_rejected_users,s.value.rows=e.data.data.last_payments,s.value.rows.forEach(t=>{const d={};d[n.t("TITLES.user")]=t.user.name,d["MLS ID"]=t.mls_id||n.t("TEXTS.notFound"),d[n.t("LABELS.status")]=t.payment_status,d[n.t("LABELS.totalPrice")]=t.total_price,d[n.t("TITLES.date")]=m(t.updated_at).format("YYYY-MM-DD"),d[n.t("TITLES.purchaseType")]=t.purchase_type,S.value.push(d)})}).catch(e=>console.error(e)).finally(()=>L.value=!1)}const B=f([]),I=f({chart:{height:350,type:"area",zoom:{enabled:!1},toolbar:{show:!1}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:3},xaxis:{tickAmount:15,tickPlacement:"between",categories:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]},yaxis:{labels:{formatter:function(e){return e==null?void 0:e.toLocaleString()}},min:0,max:0},tooltip:{x:{format:"dd/MM/yy HH:mm"}},fill:{opacity:0,type:"gradient",gradient:{shade:"light",shadeIntensity:.4,inverseColors:!1,opacityFrom:0,opacityTo:.3,stops:[0,50,53,91]}},grid:{show:!0,borderColor:"#F2F3F3",strokeDashArray:5},colors:["#FAE7E9","#12B76A","#333333","#CE1127"],legend:{horizontalAlign:"right",fontFamily:"Neo Sans",fontWeight:300,fontSize:"15px",inverseOrder:!0,itemMargin:{horizontal:15,vertical:10},markers:{width:9,height:9,offsetY:1}}}),u=f("month"),g=f(12),y=f(30),C=f(!1);async function D(){C.value=!0;let e,r;u.value==="month"?(g.value===12?e=m().subtract(11,"months").format("YYYY-MM-DD"):e=m().subtract(5,"months").format("YYYY-MM-DD"),r=m().endOf("month").format("YYYY-MM-DD")):(r=m().format("YYYY-MM-DD"),y.value===30?e=m().subtract(29,"days").format("YYYY-MM-DD"):e=m().subtract(6,"days").format("YYYY-MM-DD")),await $.get("/admin/Insights/getSubscriptionsChartData",{params:{filter_by:u.value,start_date:e,end_date:r}}).then(t=>{const d=t.data.data,o=d.reduce((c,p)=>(c[p.purchase_type]||(c[p.purchase_type]=[]),c[p.purchase_type].push(p),c),{});let i=[];for(let c in o){const p={name:c,data:o[c].map(_=>_.total_amount)};i.push(p)}if(B.value=i.reverse(),I.value.yaxis.max=Math.max(...d.map(c=>c.total_amount)),u.value==="month"){let c=function(p){let _=[];for(let a=0;a<p;a++){let k=m().subtract(a,"months").format("MMM");_.push(k)}return _.reverse()};I.value.xaxis.categories=c(g.value)}else{let c=function(p){let _=[];for(let a=0;a<p;a++){let k=m().subtract(a,"days").format("YYYY-MM-DD");_.push(k)}return _.reverse()};I.value.xaxis.categories=c(y.value)}}).catch(t=>console.error(t)).finally(()=>C.value=!1)}return z(()=>{V("General Insights")&&j(),V("Get Subscriptions Chart Data")&&D()}),(e,r)=>{const t=w("Loader"),d=w("apexchart"),o=w("JsonExcel"),i=w("RouterLink"),c=w("Table"),p=w("Card"),_=J("tooltip");return v(),E(p,null,{default:b(()=>[l("div",Q,[(v(!0),T(G,null,R(x.value,(a,k)=>(v(),E(K,{index:k,insight:a},null,8,["index","insight"]))),256))]),l("div",Z,[l("div",tt,[l("h5",et,h(e.$t("TITLES.totalPayments")),1),l("div",at,[l("button",{type:"button",class:Y(["filter-btn w-full md:w-auto",u.value==="month"&&g.value===12&&"active"]),disabled:u.value==="month"&&g.value===12,onClick:r[0]||(r[0]=a=>{u.value,g.value=12,D()})},h(e.$t("BUTTONS.12Months")),11,st),l("button",{type:"button",class:Y(["filter-btn w-full md:w-auto",u.value==="month"&&g.value===6&&"active"]),disabled:u.value==="month"&&g.value===6,onClick:r[1]||(r[1]=a=>{u.value="month",g.value=6,D()})},h(e.$t("BUTTONS.6Months")),11,lt),l("button",{type:"button",class:Y(["filter-btn w-full md:w-auto",u.value==="day"&&y.value===30&&"active"]),disabled:u.value==="day"&&y.value===30,onClick:r[2]||(r[2]=a=>{u.value="day",y.value=30,D()})},h(e.$t("BUTTONS.30Days")),11,nt),l("button",{type:"button",class:Y(["filter-btn w-full md:w-auto",u.value==="day"&&y.value===7&&"active"]),disabled:u.value==="day"&&y.value===7,onClick:r[3]||(r[3]=a=>{u.value="day",y.value=7,D()})},h(e.$t("BUTTONS.7Days")),11,ot)])]),l("div",it,[C.value?(v(),T("div",rt,[M(t)])):(v(),E(d,{key:1,type:"area",height:"350",options:I.value,series:B.value},null,8,["options","series"]))])]),l("div",ut,[l("div",dt,[l("div",ct,[l("h5",ht,h(e.$t("TITLES.lastPayments")),1),l("div",pt,[L.value?H("",!0):(v(),T("div",mt,[M(o,{data:S.value,rtl:N(n).locale.value==="ar",name:"Last Payments"},{default:b(()=>[l("button",ft,h(e.$t("BUTTONS.exportData")),1)]),_:1},8,["data","rtl"])])),M(i,{to:"/payment",class:"font-medium text-primary underline dark:text-dark-primary"},{default:b(()=>[F(h(e.$t("BUTTONS.allPayments")),1)]),_:1})])]),L.value?(v(),T("div",vt,[M(t)])):(v(),E(c,{key:1,"is-slot-mode":!0,columns:s.value.columns,rows:s.value.rows,sortable:{sort:"asc"},onDoSearch:U,pagination:!1,"is-hide-paging":!0,class:"font-medium"},{user:b(a=>[X((v(),T("h5",{class:"max-w-[150px] truncate",title:a.value.user.name},[F(h(a.value.user.name),1)],8,_t)),[[_]])]),mls_id:b(a=>[l("span",null,h(a.value.user.mls_id||e.$t("TEXTS.notFound")),1)]),payment_status:b(a=>[l("span",{class:Y(["capitalize",a.value.payment_status==="approved"?"text-green":"text-primary dark:text-dark-primary"])},h(a.value.payment_status),3)]),updated_at:b(a=>[F(h(N(m)(a.value.updated_at).format("YYYY-MM-DD")),1)]),purchase_type:b(a=>[l("span",gt,h(a.value.purchase_type),1)]),_:1},8,["columns","rows"]))])])]),_:1})}}};export{xt as default};
