import{c as F}from"./checkPermission-Ceto9Xa7.js";import{u as O,r as d,y as x,f as z,h as A,w as p,P as X,x as Y,g as y,l as M,o as s,a as c,n as C,t as n,j as g,c as u,i as B,b as j,Q as G,p as T,q as w,F as J,N as Q}from"./index-PF4Eq7D6.js";import{h as H}from"./moment-C5S46NFB.js";import"./hasPermission-CVzDC8fh.js";const K={class:"border-b-border mb-5 flex flex-col items-center gap-3 dark:border-b-dark-border lg:mb-7 lg:flex-row lg:gap-5 lg:border-b"},W=["disabled"],Z=["disabled"],ee={class:"mb-5 grid grid-cols-12 gap-3 lg:mb-7 lg:gap-5"},ae={class:"col-span-12 xl:col-span-6"},le={class:"col-span-12 xl:col-span-6"},te={key:0,class:"flex items-center justify-center rounded-[10px] bg-white py-20 dark:bg-transparent"},oe={key:0,class:"flex items-center justify-end"},re={type:"button",class:"mb-5 rounded-full bg-primary px-7 py-3 text-white"},se=["title"],ne=["href","title"],ie={key:1},ue=["title"],de=["href","title"],pe={key:1},me=["href","title"],ce={key:1},ve={key:2,class:"mt-12"},ke={__name:"index",setup(_e){const r=O(),t=X(),P=Y();function $(a,l){P.push({path:"/application-approvals",query:Object.assign({},t.query,{[a]:l})})}const E=d(t.query.name||"");x(E,a=>{$("name",a)});const q=d(t.query.email||"");x(q,a=>{$("email",a)});const v=d({columns:[{label:r.t("TITLES.companyName"),field:"user"},{label:r.t("TITLES.registrationDate"),field:"date"},{label:r.t("TITLES.email"),field:"email"},{label:r.t("TITLES.userName"),field:"first_name"},{label:r.t("TITLES.userEmail"),field:t.query.type==="developers"?"developer_email":"broker_email"},{label:r.t("TITLES.control"),field:"control"}],rows:[]}),V=d([]),L=d(0),S=d(0),N=d(0),I=d(t.query.page||1),k=d(t.query.type||"brokers");x(k,a=>{$("type",a)});const m=d(!1);async function D(){m.value=!0;let a;const l={},_={status:"pending",operator:"and"},f={status:"pending",operator:"and"};t.query.name?_.name=f.name=t.query.name:(delete _.name,delete f.name),t.query.email?_.email=f.email=t.query.email:(delete _.email,delete f.email),t.query.type==="developers"?(a="/admin/developer/getByFilter",l.developers=f,delete l.brokers):(a="/admin/broker/getByFilter",l.brokers=_,delete l.developers),await Q.post(a,{filters:l,page:t.query.page||1,page_size:9999,related_objects:[],related_objects_count:[]}).then(i=>{t.query.type==="developers"?(v.value.rows=i.data.data.developer.data,L.value=i.data.data.developer.total,N.value=i.data.data.developer.per_page,S.value=i.data.data.developer.last_page):(v.value.rows=i.data.data.broker.data,L.value=i.data.data.broker.total,N.value=i.data.data.broker.per_page,S.value=i.data.data.broker.last_page),v.value.rows.map(o=>{const b={};b[r.t("TITLES.companyName")]=o.name,b[r.t("TITLES.registrationDate")]=o.date?H(o.date).format("YYYY-MM-DD"):r.t("TEXTS.notFound"),b[r.t("TITLES.email")]=o.email&&o.email!=="undefined"?o.email:"",b[r.t("TITLES.userName")]=`${o.first_name&&o.first_name!=="undefined"?o.first_name:""} ${o.last_name&&o.last_name!=="undefined"?o.last_name:""}`,b[r.t("TITLES.userEmail")]=t.query.type==="developers"?o.developer_email:o.broker_email,V.value.push(b)})}).catch(i=>console.error(i)).finally(()=>m.value=!1)}return x(()=>t.query,a=>{a.type==="developers"?v.value.columns[4].field="developer_email":v.value.columns[4].field="broker_email",D()},{deep:!0,immediate:!0}),z(()=>{F("Filter Broker"),F("Filter Developer")}),(a,l)=>{const _=y("Search"),f=y("Loader"),i=y("JsonExcel"),o=y("RouterLink"),b=y("Table"),U=y("Pagination"),R=y("Card"),h=M("tooltip");return s(),A(R,{loading:m.value,class:"card-shadow my-5",number:L.value},{default:p(()=>[c("div",K,[c("button",{type:"button",class:C(["w-full rounded-xl px-7 py-2.5 duration-300 disabled:cursor-not-allowed lg:w-auto lg:rounded-b-none",k.value==="brokers"&&"bg-primary text-white dark:bg-dark-primary"]),disabled:m.value,onClick:l[0]||(l[0]=e=>k.value="brokers")},n(a.$t("BUTTONS.brokersRequests")),11,W),c("button",{type:"button",class:C(["w-full rounded-xl px-7 py-2.5 duration-300 disabled:cursor-not-allowed lg:w-auto lg:rounded-b-none",k.value==="developers"&&"bg-primary text-white dark:bg-dark-primary"]),disabled:m.value,onClick:l[1]||(l[1]=e=>k.value="developers")},n(a.$t("BUTTONS.developersRequests")),11,Z)]),c("div",ee,[c("div",ae,[g(_,{modelValue:E.value,"onUpdate:modelValue":l[2]||(l[2]=e=>E.value=e),placeholder:a.$t("INPUTS.applicationApprovalsSearchByCompanyName"),disabled:m.value},null,8,["modelValue","placeholder","disabled"])]),c("div",le,[g(_,{modelValue:q.value,"onUpdate:modelValue":l[3]||(l[3]=e=>q.value=e),placeholder:a.$t("INPUTS.applicationApprovalsSearchByEmail"),disabled:m.value},null,8,["modelValue","placeholder","disabled"])])]),m.value?(s(),u("div",te,[g(f)])):(s(),u(J,{key:1},[v.value.rows.length?(s(),u("div",oe,[g(i,{data:V.value,rtl:B(r).locale.value==="ar",name:"Application Approvals"},{default:p(()=>[c("button",re,n(a.$t("BUTTONS.exportData")),1)]),_:1},8,["data","rtl"])])):j("",!0),g(b,{"is-slot-mode":!0,columns:v.value.columns,rows:v.value.rows,pagination:!1,"is-hide-paging":!0,class:"font-medium"},G({user:p(e=>[T((s(),u("h5",{class:"max-w-[150px] truncate",title:e.value.name},[w(n(e.value.name),1)],8,se)),[[h]])]),date:p(e=>[c("span",null,n(new Date(e.value.created_at).toLocaleDateString(a.$i18n.locale==="ar"?`${a.$i18n.locale}-GB`:`${a.$i18n.locale}-EG`,{day:"numeric",month:"long",year:"numeric"})),1)]),email:p(e=>[e.value.email&&e.value.email!="undefined"?T((s(),u("a",{key:0,href:`mailto:${e.value.email}`,class:"inline-block max-w-[150px] truncate",title:e.value.email&&e.value.email!=="undefined"?e.value.email:""},[w(n(e.value.email),1)],8,ne)),[[h]]):(s(),u("span",ie,n(a.$t("TEXTS.notFound")),1))]),first_name:p(e=>[T((s(),u("span",{class:"inline-block max-w-[150px] truncate",title:`${e.value.first_name&&e.value.first_name!=="undefined"?e.value.first_name:""} ${e.value.last_name&&e.value.last_name!=="undefined"?e.value.last_name:""}`},[w(n(e.value.first_name&&e.value.first_name!=="undefined"?e.value.first_name:"")+" "+n(e.value.last_name&&e.value.last_name!=="undefined"?e.value.last_name:""),1)],8,ue)),[[h]])]),control:p(e=>[g(o,{to:`/application/${e.value.user_id}/details`,class:"ps-5"},{default:p(()=>l[6]||(l[6]=[c("i",{class:"fa-solid fa-eye"},null,-1)])),_:2},1032,["to"])]),_:2},[B(t).query.type==="developers"?{name:"developer_email",fn:p(e=>[e.value.developer_email&&e.value.developer_email!="undefined"?T((s(),u("a",{key:0,href:`mailto:${e.value.developer_email}`,class:"inline-block max-w-[150px] truncate",title:e.value.developer_email},[w(n(e.value.developer_email),1)],8,de)),[[h]]):(s(),u("span",pe,n(a.$t("TEXTS.notFound")),1))]),key:"0"}:{name:"broker_email",fn:p(e=>[e.value.broker_email&&e.value.broker_email!="undefined"?T((s(),u("a",{key:0,href:`mailto:${e.value.broker_email}`,title:e.value.broker_email,class:"inline-block max-w-[150px] truncate"},[w(n(e.value.broker_email),1)],8,me)),[[h]]):(s(),u("span",ce,n(a.$t("TEXTS.notFound")),1))]),key:"1"}]),1032,["columns","rows"])],64)),S.value>1&&!m.value?(s(),u("div",ve,[g(U,{modelValue:I.value,"onUpdate:modelValue":[l[4]||(l[4]=e=>I.value=e),l[5]||(l[5]=e=>a.$router.push({path:"/application-approvals",query:Object.assign({},B(t).query,{page:I.value})}).then(()=>D()))],pages:S.value,rageSize:N.value,activeColor:""},null,8,["modelValue","pages","rageSize"])])):j("",!0)]),_:1},8,["loading","number"])}}};export{ke as default};
